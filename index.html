<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub å…¨ç«™é€£çµæƒæå™¨</title>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; background-color: #f6f8fa; }
        h2 { color: #24292e; }
        .controls { background: white; padding: 20px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.12); margin-bottom: 20px; }
        input, button { padding: 10px; font-size: 16px; }
        button { background-color: #2ea44f; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background-color: #2c974b; }
        button:disabled { background-color: #94d3a2; cursor: not-allowed; }
        
        .repo-block { background: white; margin-bottom: 15px; border: 1px solid #e1e4e8; border-radius: 6px; overflow: hidden; }
        .repo-header { background: #f1f8ff; padding: 10px 15px; font-weight: bold; border-bottom: 1px solid #e1e4e8; display: flex; justify-content: space-between; align-items: center; }
        .repo-content { padding: 10px 15px; }
        .link-item { padding: 4px 0; border-bottom: 1px solid #eee; }
        .link-item a { text-decoration: none; color: #0366d6; word-break: break-all; }
        .link-item a:hover { text-decoration: underline; }
        .status-msg { margin-top: 10px; font-weight: bold; color: #555; }
        .badge { background: #eee; padding: 2px 6px; border-radius: 10px; font-size: 0.8em; color: #666; }
    </style>
</head>
<body>

    <h2>GitHub å…¨ç«™ç¶²é æƒæå™¨</h2>
    
    <div class="controls">
        <label>ç›®æ¨™ä½¿ç”¨è€… (User):</label>
        <input type="text" id="username" value="issac-sjps">
        <button id="btnScan" onclick="scanAllRepos()">é–‹å§‹å…¨ç«™æƒæ</button>
        <div id="globalStatus" class="status-msg">æº–å‚™å°±ç·’</div>
    </div>

    <div id="resultsArea"></div>

    <script>
        async function scanAllRepos() {
            const user = document.getElementById('username').value;
            const resultsArea = document.getElementById('resultsArea');
            const statusLabel = document.getElementById('globalStatus');
            const btn = document.getElementById('btnScan');

            // åˆå§‹åŒ–
            resultsArea.innerHTML = '';
            statusLabel.textContent = 'æ­£åœ¨å–å¾—å°ˆæ¡ˆåˆ—è¡¨...';
            btn.disabled = true;

            try {
                // 1. å–å¾—è©²ä½¿ç”¨è€…æ‰€æœ‰çš„ Repositories
                const userReposUrl = `https://api.github.com/users/${user}/repos?per_page=100`;
                const repoResponse = await fetch(userReposUrl);
                
                if (!repoResponse.ok) throw new Error("æ‰¾ä¸åˆ°ä½¿ç”¨è€…æˆ– API æ¬¡æ•¸é™åˆ¶");
                
                const repos = await repoResponse.json();
                statusLabel.textContent = `æ‰¾åˆ° ${repos.length} å€‹å°ˆæ¡ˆï¼Œé–‹å§‹é€ä¸€è®€å–æª”æ¡ˆ...`;

                // 2. é‡å°æ¯ä¸€å€‹ Repo å»æŠ“å…§å®¹
                for (const repo of repos) {
                    await fetchRepoContents(user, repo.name, resultsArea);
                }

                statusLabel.textContent = `æƒæå®Œæˆï¼å…±æƒæ ${repos.length} å€‹å°ˆæ¡ˆã€‚`;

            } catch (error) {
                statusLabel.textContent = `ç™¼ç”ŸéŒ¯èª¤: ${error.message}`;
                statusLabel.style.color = 'red';
            } finally {
                btn.disabled = false;
            }
        }

        async function fetchRepoContents(user, repoName, container) {
            // å»ºç«‹é¡¯ç¤ºå€å¡Š
            const block = document.createElement('div');
            block.className = 'repo-block';
            const header = document.createElement('div');
            header.className = 'repo-header';
            header.innerHTML = `<span>ğŸ“‚ ${repoName}</span> <span class="badge" id="badge-${repoName}">è®€å–ä¸­...</span>`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'repo-content';
            contentDiv.id = `content-${repoName}`;

            block.appendChild(header);
            block.appendChild(contentDiv);
            container.appendChild(block);

            // GitHub Pages çš„åŸºç¤ç¶²å€
            const pagesBaseUrl = `https://${user}.github.io/${repoName}/`;
            const apiUrl = `https://api.github.com/repos/${user}/${repoName}/contents/`;

            try {
                const response = await fetch(apiUrl);
                if (response.status === 404) {
                    document.getElementById(`badge-${repoName}`).textContent = "ç„¡å…§å®¹æˆ–ç©ºå°ˆæ¡ˆ";
                    return;
                }
                
                const files = await response.json();
                let count = 0;

                if (Array.isArray(files)) {
                    for (const file of files) {
                        // éæ¿¾é‚è¼¯ï¼šåªæŠ“æª”æ¡ˆï¼Œå¿½ç•¥ . é–‹é ­çš„è¨­å®šæª” (å¦‚ .gitignore)
                        if (file.type === 'file' && !file.name.startsWith('.')) {
                            const linkDiv = document.createElement('div');
                            linkDiv.className = 'link-item';
                            // çµ„åˆå®Œæ•´ç¶²å€
                            const fullUrl = pagesBaseUrl + encodeURI(file.name);
                            linkDiv.innerHTML = `<a href="${fullUrl}" target="_blank">${fullUrl}</a>`;
                            contentDiv.appendChild(linkDiv);
                            count++;
                        }
                    }
                }
                
                document.getElementById(`badge-${repoName}`).textContent = `${count} å€‹æª”æ¡ˆ`;

            } catch (e) {
                document.getElementById(`badge-${repoName}`).textContent = "è®€å–å¤±æ•—";
                console.error(e);
            }
        }
    </script>
</body>
</html>
